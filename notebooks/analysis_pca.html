
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2. PC analysis &#8212; Storm Surge NZ - Summary</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.37f24b989f4638ff9c27c22dc7559d4f.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. KM analysis" href="analysis_kma.html" />
    <link rel="prev" title="1. Data visualization and validation" href="data_visualization.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.jpeg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Storm Surge NZ - Summary</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../README.html">
   geoocean-nz-ss
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Chapters
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="data_visualization.html">
   1. Data visualization and validation
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   2. PC analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="analysis_kma.html">
   3. KM analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="models_linear.html">
   4. MultiLinear regression models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="models_knn.html">
   5. KNN regressor models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="models_mda_rbf.html">
   6. MDA - RBF model
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/analysis_pca.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/javitausia/geocean-nz-ss"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/javitausia/geocean-nz-ss/issues/new?title=Issue%20on%20page%20%2Fnotebooks/analysis_pca.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/javitausia/geocean-nz-ss/master?urlpath=tree/notebooks/analysis_pca.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#principal-components-analysis-theory">
   2.1. Principal components analysis theory
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-the-data-without-plotting">
   2.2. Load the data without plotting
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pca-usage-explanation">
   2.3. PCA usage explanation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pca-examples">
   2.4. PCA examples:
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regional-pcs-analysis">
     2.4.1. Regional PCs analysis
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#local-regional-pcs-with-gradient">
     2.4.2. Local-Regional PCs (with gradient)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#local-pcs-with-wind-and-gradient">
     2.4.3. Local PCs (with wind and gradient)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#local-pcs-just-slp-with-time-lapse">
     2.4.4. Local PCs (just SLP with time lapse)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#storm-surge-pcs">
     2.4.5. Storm-Surge PCs
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="pc-analysis">
<h1><span class="section-number">2. </span>PC analysis<a class="headerlink" href="#pc-analysis" title="Permalink to this headline">¶</a></h1>
<div class="section" id="principal-components-analysis-theory">
<h2><span class="section-number">2.1. </span>Principal components analysis theory<a class="headerlink" href="#principal-components-analysis-theory" title="Permalink to this headline">¶</a></h2>
<p>In this notebook, the Principal Component Analysis (PCA) is performed. With this dimensionality reduction technique we are able to reduce the dimension of the data, which in the case of a regional predictor for the sea-level-pressure fields, exceeds the thousands of variables… All the python code is hosted at <code class="docutils literal notranslate"><span class="pre">sscode/pca.py</span></code>, where we use the scikit-learn package available <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.PCA.html">here</a>.</p>
<p>Regarding the maths, an explanation of what PCA is can be found at <a class="reference external" href="https://en.wikipedia.org/wiki/Principal_component_analysis">wikipedia</a>, but it will be briefly explained here:</p>
<p>The PCA reduces the dimension of the data by means of a projection in a lower dimensional space that preserves the maximum variance of the sample data. The new vectors are formed by the ones where the projected data have the higher variance. Given the spatiotemporal variable <span class="math notranslate nohighlight">\(X_i (x, t_i)\)</span>, where <span class="math notranslate nohighlight">\(x\)</span> is the spatial data position of dimension <span class="math notranslate nohighlight">\(3n1 + 2n2\)</span> and <span class="math notranslate nohighlight">\(t_i\)</span> is the time, we apply PCA to obtain a new <span class="math notranslate nohighlight">\(d\)</span>-dimensional space. The eigenvectors [empirical orthogonal functions (EOFs)] of the covariance matrix of the data define the vectors of the new space. The idea of PCA is to find the minimum <span class="math notranslate nohighlight">\(d\)</span> linearly EOFs, so that the transformed components of the original data [principal components (PCs)] explain the maximum variance necessary in the problem at hand. The original data can be expressed as a linear combination of EOFs and PCs,</p>
<div class="math notranslate nohighlight">
\[
\boxed{
X (x,t_i) = EOF_1(x)\times PC_1(t_i) + EOF_2(x)\times PC_2(t_i) + ... + EOF_d(x)\times PC_d(t_i)
}
\]</div>
<p>Once we apply PCA, our data are defined by the principal components <span class="math notranslate nohighlight">\(X_i^{EOF}={PC_1,PC_2,...,PC_d}, i=1,...,P \)</span>. A better explanation can be also found <a class="reference external" href="https://stanford.edu/~shervine/teaching/cs-229/cheatsheet-unsupervised-learning">here</a>!!</p>
<div class="figure align-default" id="pca">
<a class="reference internal image-reference" href="../_images/pca-analysis.png"><img alt="../_images/pca-analysis.png" src="../_images/pca-analysis.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 2.1 </span><span class="caption-text">This picture shows how the dimensionality reduction that performs PCA might help when identifying patterns in data (<a class="reference external" href="https://programmerclick.com/images/486/0351bfe3610a3ba89bea599ee9d054ae.png">image reference</a>)</span><a class="headerlink" href="#pca" title="Permalink to this image">¶</a></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># basics</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>

<span class="c1"># append sscode to path</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">))</span>

<span class="c1"># custom</span>
<span class="kn">from</span> <span class="nn">sscode.data</span> <span class="kn">import</span> <span class="n">Loader</span><span class="p">,</span> <span class="n">load_moana_hindcast_ss</span>
<span class="kn">from</span> <span class="nn">sscode.pca</span> <span class="kn">import</span> <span class="n">PCA_DynamicPred</span>
<span class="kn">from</span> <span class="nn">sscode.config</span> <span class="kn">import</span> <span class="n">default_region_reduced</span>

<span class="c1"># warnings</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="load-the-data-without-plotting">
<h2><span class="section-number">2.2. </span>Load the data without plotting<a class="headerlink" href="#load-the-data-without-plotting" title="Permalink to this headline">¶</a></h2>
<p>As always, we first load the data using our <code class="docutils literal notranslate"><span class="pre">Loader</span></code> python class, so then we can easily use all the datasets. Notice that here, we set the <code class="docutils literal notranslate"><span class="pre">plot</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the data</span>
<span class="n">load_cfsr_moana_uhslc</span> <span class="o">=</span> <span class="n">Loader</span><span class="p">(</span>
    <span class="n">data_to_load</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cfsr&#39;</span><span class="p">,</span><span class="s1">&#39;moana&#39;</span><span class="p">,</span><span class="s1">&#39;uhslc&#39;</span><span class="p">],</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> loading the sea-level-pressure fields... 


 loading daily resampled data... 


 loading the Moana v2 hindcast data... 


 loading and plotting the UHSLC tidal guages... 
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="pca-usage-explanation">
<h2><span class="section-number">2.3. </span>PCA usage explanation<a class="headerlink" href="#pca-usage-explanation" title="Permalink to this headline">¶</a></h2>
<p>To use the pre-build PCA functions, the user must get familiar with the datasets and the way everything is programmed.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For this reason, have always in mind that <a class="reference external" href="http://xarray.pydata.org/en/stable/getting-started-guide/why-xarray.html">xarray</a> will be the main python data analysis library used in the project, and then, python functions will usually depend on these <a class="reference external" href="http://xarray.pydata.org/en/stable/generated/xarray.Dataset.html">Datasets</a> / <a class="reference external" href="http://xarray.pydata.org/en/stable/generated/xarray.DataArray.html">DataArrays</a>, which are very useful when working with multiple dimensions and variables</p>
</div>
<p>regarding the PCA usage, have a look at the piece of code below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">PCA_DynamicPred</span><span class="p">(</span><span class="n">pres</span><span class="p">,</span> <span class="n">pres_vars</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;SLP&#39;</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span><span class="s1">&#39;latitude&#39;</span><span class="p">),</span>
                        <span class="n">calculate_gradient</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">winds</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span>
                        <span class="n">wind_vars</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;wind_proj_mask&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">),</span>
                        <span class="n">time_lapse</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># 1 equals to NO time delay </span>
                        <span class="n">time_resample</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;1D&#39;</span><span class="p">,</span>
                        <span class="n">region</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="n">default_region</span><span class="p">),</span>
                        <span class="n">pca_plot</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
                        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="n">pca_ttls</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pca_borders</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform PCA decomposition given the pressure, winds...</span>

<span class="sd">        Args:</span>
<span class="sd">            pres (xarray.Dataarray/Dataset): These are the sea-level-pressure fields,</span>
<span class="sd">                that could be loaded  both with load_era5() or load_cfsr(), and</span>
<span class="sd">                obviously with the Loader object!!</span>
<span class="sd">                    ** this parameter can be used to calculate PCA </span>
<span class="sd">                       with different data </span>
<span class="sd">                    **</span>
<span class="sd">            pres_vars (tuple, optional): These are the slp xarray coordinates. </span>
<span class="sd">                - Defaults to (&#39;msl&#39;,&#39;longitude&#39;,&#39;latitude&#39;).</span>
<span class="sd">            calculate_gradient (bool, optional): weather to calculate or not the slp gradient.</span>
<span class="sd">                - Defaults to False.</span>
<span class="sd">            winds (tuple, optional): This is the wind data, if available...</span>
<span class="sd">                - Defaults to (False,None), data must be xarray!!</span>
<span class="sd">            wind_vars (tuple, optional): These are the wind coordinates. </span>
<span class="sd">                - Defaults to (&#39;wind_proj&#39;,&#39;longitude&#39;,&#39;latitude&#39;).</span>
<span class="sd">            time_lapse (int, optional): Time delay for the dynamic predictor. </span>
<span class="sd">                - Defaults to 2.</span>
<span class="sd">            time_resample (str, optional): This is the time resample.</span>
<span class="sd">                - Defaults to &#39;1D&#39;.</span>
<span class="sd">            region (tuple, optional): Region to crop the slp to. </span>
<span class="sd">                - Defaults to (True,default_region).</span>
<span class="sd">            pca_plot (tuple, bool): Wether to plot or not the final results.</span>
<span class="sd">                - Defaults to (True,False), as the second boolean indicator refers</span>
<span class="sd">                to the de-standarization of the EOFs, which is not totally validated</span>
<span class="sd">            verbose (bool, optional): Wether or not to debug the actions.</span>
<span class="sd">                - Defaults to True.</span>
<span class="sd">            pca_ttls: These are the titles for the pca plots if wanted.</span>
<span class="sd">            pca_borders: Limits to use in the pca plots.</span>

<span class="sd">        Returns:</span>
<span class="sd">            [xarray.Dataset]: PCA decomposition final results</span>
<span class="sd">        &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>as this is the aspect of all the functions that are used. For this particular case, we must give the function the previouly loaded slp fields, which are stored at <code class="docutils literal notranslate"><span class="pre">load_cfsr_moana_uhslc.predictor_slp</span></code>, and then specify the actions that we want to perform over this raw dataset. Here some examples of the available actions:</p>
</div>
<div class="section" id="pca-examples">
<h2><span class="section-number">2.4. </span>PCA examples:<a class="headerlink" href="#pca-examples" title="Permalink to this headline">¶</a></h2>
<p>Below, different PCA analysis with different inputs are shown:</p>
<div class="section" id="regional-pcs-analysis">
<h3><span class="section-number">2.4.1. </span>Regional PCs analysis<a class="headerlink" href="#regional-pcs-analysis" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load / calculate the regional pcs</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;../data/cfsr/cfsr_regional_daily_pcs.nc&#39;</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
    <span class="n">pcs_cfsr</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
        <span class="s1">&#39;../data/cfsr/cfsr_regional_daily_pcs.nc&#39;</span>
    <span class="p">)</span>
    <span class="kn">from</span> <span class="nn">sscode.plotting.pca</span> <span class="kn">import</span> <span class="n">plot_pcs</span>
    <span class="n">plot_pcs</span><span class="p">(</span><span class="n">pcs_cfsr</span><span class="p">,</span><span class="n">n_plot</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># here is how this loaded regional pcs were calculated</span>
    <span class="n">pcs_data</span><span class="p">,</span> <span class="n">pcs_scaler</span> <span class="o">=</span> <span class="n">PCA_DynamicPred</span><span class="p">(</span>
        <span class="n">load_cfsr_moana_uhslc</span><span class="o">.</span><span class="n">predictor_slp</span><span class="p">,</span> 
        <span class="n">calculate_gradient</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span> <span class="c1"># look the simplicity of the function</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> plotting 3 components with 2 EOFs + PC... 


 being the EOFs the slp, the gradient, in steps t, t-1 
</pre></div>
</div>
<img alt="../_images/analysis_pca_7_1.png" src="../_images/analysis_pca_7_1.png" />
<img alt="../_images/analysis_pca_7_2.png" src="../_images/analysis_pca_7_2.png" />
<img alt="../_images/analysis_pca_7_3.png" src="../_images/analysis_pca_7_3.png" />
<img alt="../_images/analysis_pca_7_4.png" src="../_images/analysis_pca_7_4.png" />
<img alt="../_images/analysis_pca_7_5.png" src="../_images/analysis_pca_7_5.png" />
<img alt="../_images/analysis_pca_7_6.png" src="../_images/analysis_pca_7_6.png" />
</div>
</div>
</div>
<div class="section" id="local-regional-pcs-with-gradient">
<h3><span class="section-number">2.4.2. </span>Local-Regional PCs (with gradient)<a class="headerlink" href="#local-regional-pcs-with-gradient" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate some local pcs</span>
<span class="n">pcs_data</span><span class="p">,</span> <span class="n">pcs_scaler</span> <span class="o">=</span> <span class="n">PCA_DynamicPred</span><span class="p">(</span>
    <span class="n">load_cfsr_moana_uhslc</span><span class="o">.</span><span class="n">predictor_slp</span><span class="p">,</span> 
    <span class="n">calculate_gradient</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">time_lapse</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="c1"># 1 = NO time lapse</span>
    <span class="n">region</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,(</span>
        <span class="n">load_cfsr_moana_uhslc</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">6.1</span><span class="p">,</span>
        <span class="n">load_cfsr_moana_uhslc</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">6.1</span><span class="p">,</span>
        <span class="n">load_cfsr_moana_uhslc</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">6.1</span><span class="p">,</span>
        <span class="n">load_cfsr_moana_uhslc</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">6.1</span>
    <span class="p">)),</span>
    <span class="n">pca_plot</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># (plot,scale,n_plot)</span>
<span class="p">)</span>
<span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">sscode.plotting.pca</span> <span class="kn">import</span> <span class="n">plot_recon_pcs</span>
    <span class="n">recon_slp</span> <span class="o">=</span> <span class="n">plot_recon_pcs</span><span class="p">(</span>
        <span class="n">pcs_data</span><span class="p">,</span> <span class="n">pcs_scaler</span><span class="p">,</span>
        <span class="n">region</span><span class="o">=</span><span class="n">default_region_reduced</span><span class="p">,</span>
        <span class="n">return_slp</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> lets calculate the PCs... 


 calculating the gradient of the sea-level-pressure fields... 


 pressure/gradient predictor both with shape: 
 (11354, 25, 25) 


 calculated PCs matrix with shape: 
 (11353, 1250) 


 plotting 3 components with 2 EOFs + PC... 


 being the EOFs the slp, the gradient, in steps t, t-1 
</pre></div>
</div>
<img alt="../_images/analysis_pca_9_1.png" src="../_images/analysis_pca_9_1.png" />
<img alt="../_images/analysis_pca_9_2.png" src="../_images/analysis_pca_9_2.png" />
<img alt="../_images/analysis_pca_9_3.png" src="../_images/analysis_pca_9_3.png" />
<img alt="../_images/analysis_pca_9_4.png" src="../_images/analysis_pca_9_4.png" />
<img alt="../_images/analysis_pca_9_5.png" src="../_images/analysis_pca_9_5.png" />
<img alt="../_images/analysis_pca_9_6.png" src="../_images/analysis_pca_9_6.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> plotting reconstruction of 2 EOFs... 


 being the EOFs the slp, the gradient, in steps t, t-1... 
</pre></div>
</div>
<img alt="../_images/analysis_pca_9_8.png" src="../_images/analysis_pca_9_8.png" />
</div>
</div>
</div>
<div class="section" id="local-pcs-with-wind-and-gradient">
<h3><span class="section-number">2.4.3. </span>Local PCs (with wind and gradient)<a class="headerlink" href="#local-pcs-with-wind-and-gradient" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># more pcs in new location</span>
<span class="n">new_location</span> <span class="o">=</span> <span class="p">(</span><span class="mi">178</span><span class="p">,</span><span class="o">-</span><span class="mi">38</span><span class="p">)</span>
<span class="n">PCA_DynamicPred</span><span class="p">(</span>
    <span class="n">load_cfsr_moana_uhslc</span><span class="o">.</span><span class="n">predictor_slp</span><span class="p">,</span> 
    <span class="n">calculate_gradient</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">time_lapse</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">region</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,(</span>
        <span class="n">new_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">2.6</span><span class="p">,</span><span class="n">new_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">2.6</span><span class="p">,</span>
        <span class="n">new_location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">2.6</span><span class="p">,</span><span class="n">new_location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">2.6</span>
    <span class="p">)),</span>
    <span class="n">winds</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="n">load_cfsr_moana_uhslc</span><span class="o">.</span><span class="n">predictor_wind</span><span class="p">),</span>
    <span class="n">wind_vars</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;wind_proj_mask&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">),</span>
    <span class="n">pca_plot</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">pca_ttls</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SLP in t&#39;</span><span class="p">,</span><span class="s1">&#39;Gradient in t&#39;</span><span class="p">,</span><span class="s1">&#39;WINDs in t&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> lets calculate the PCs... 


 adding the wind to the predictor... 


 winds predictor with shape: 
 (11354, 11, 11) 


 calculating the gradient of the sea-level-pressure fields... 


 pressure/gradient predictor both with shape: 
 (11354, 11, 11) 


 calculated PCs matrix with shape: 
 (11353, 363) 


 plotting 2 components with 3 EOFs + PC... 


 being the EOFs the slp, the gradient, in steps t, t-1 
</pre></div>
</div>
<img alt="../_images/analysis_pca_11_1.png" src="../_images/analysis_pca_11_1.png" />
<img alt="../_images/analysis_pca_11_2.png" src="../_images/analysis_pca_11_2.png" />
<img alt="../_images/analysis_pca_11_3.png" src="../_images/analysis_pca_11_3.png" />
<img alt="../_images/analysis_pca_11_4.png" src="../_images/analysis_pca_11_4.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;xarray.Dataset&gt;
 Dimensions:   (n_components: 363, n_features: 363, n_lat: 11, n_lon: 11, time: 11353)
 Coordinates:
   * time      (time) datetime64[ns] 1990-01-01 1990-01-02 ... 2021-01-30
 Dimensions without coordinates: n_components, n_features, n_lat, n_lon
 Data variables:
     PCs       (time, n_components) float64 -7.43 4.781 ... 2.259e-18 1.382e-19
     EOFs      (n_components, n_features) float64 -0.07382 -0.07481 ... 0.0 0.0
     variance  (n_components) float64 138.3 54.97 42.0 ... 8.679e-35 5.777e-36
     pcs_lon   (n_lon) float32 175.5 176.0 176.5 177.0 ... 179.5 180.0 180.5
     pcs_lat   (n_lat) float32 -35.5 -36.0 -36.5 -37.0 ... -39.5 -40.0 -40.5,
 StandardScaler())
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="local-pcs-just-slp-with-time-lapse">
<h3><span class="section-number">2.4.4. </span>Local PCs (just SLP with time lapse)<a class="headerlink" href="#local-pcs-just-slp-with-time-lapse" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># more pcs with time lapse</span>
<span class="n">new_location</span> <span class="o">=</span> <span class="p">(</span><span class="mi">168</span><span class="p">,</span><span class="o">-</span><span class="mi">44</span><span class="p">)</span>
<span class="n">PCA_DynamicPred</span><span class="p">(</span>
    <span class="n">load_cfsr_moana_uhslc</span><span class="o">.</span><span class="n">predictor_slp</span><span class="p">,</span> 
    <span class="n">calculate_gradient</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">time_lapse</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">region</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,(</span>
        <span class="n">new_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">2.6</span><span class="p">,</span><span class="n">new_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">2.6</span><span class="p">,</span>
        <span class="n">new_location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">2.6</span><span class="p">,</span><span class="n">new_location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">2.6</span>
    <span class="p">)),</span>
    <span class="n">pca_plot</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">pca_ttls</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SLP in t&#39;</span><span class="p">,</span><span class="s1">&#39;SLP in t-1&#39;</span><span class="p">,</span><span class="s1">&#39;SLP in t-2&#39;</span><span class="p">,</span><span class="s1">&#39;SLP in t-3&#39;</span><span class="p">,</span><span class="s1">&#39;SLP in t-4&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> lets calculate the PCs... 


 calculated PCs matrix with shape: 
 (11349, 605) 


 plotting 3 components with 5 EOFs + PC... 


 being the EOFs the slp, the gradient, in steps t, t-1 
</pre></div>
</div>
<img alt="../_images/analysis_pca_13_1.png" src="../_images/analysis_pca_13_1.png" />
<img alt="../_images/analysis_pca_13_2.png" src="../_images/analysis_pca_13_2.png" />
<img alt="../_images/analysis_pca_13_3.png" src="../_images/analysis_pca_13_3.png" />
<img alt="../_images/analysis_pca_13_4.png" src="../_images/analysis_pca_13_4.png" />
<img alt="../_images/analysis_pca_13_5.png" src="../_images/analysis_pca_13_5.png" />
<img alt="../_images/analysis_pca_13_6.png" src="../_images/analysis_pca_13_6.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;xarray.Dataset&gt;
 Dimensions:   (n_components: 605, n_features: 605, n_lat: 11, n_lon: 11, time: 11349)
 Coordinates:
   * time      (time) datetime64[ns] 1990-01-01 1990-01-02 ... 2021-01-26
 Dimensions without coordinates: n_components, n_features, n_lat, n_lon
 Data variables:
     PCs       (time, n_components) float64 -15.87 -0.9563 ... -6.611e-06
     EOFs      (n_components, n_features) float64 -0.03065 -0.03139 ... -0.009912
     variance  (n_components) float64 374.0 134.9 47.98 ... 2.325e-11 2.303e-11
     pcs_lon   (n_lon) float32 165.5 166.0 166.5 167.0 ... 169.5 170.0 170.5
     pcs_lat   (n_lat) float32 -41.5 -42.0 -42.5 -43.0 ... -45.5 -46.0 -46.5,
 StandardScaler())
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="storm-surge-pcs">
<h3><span class="section-number">2.4.5. </span>Storm-Surge PCs<a class="headerlink" href="#storm-surge-pcs" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate the pcs of the storm surge</span>
<span class="n">interp_ss</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">interp_ss</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">from</span> <span class="nn">sscode.config</span> <span class="kn">import</span> <span class="n">default_region_reduced</span>
    <span class="n">pcs_ss</span><span class="p">,</span> <span class="n">ss_scaler</span> <span class="o">=</span> <span class="n">PCA_DynamicPred</span><span class="p">(</span>
        <span class="n">load_moana_hindcast_ss</span><span class="p">(</span><span class="n">daily</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
            <span class="n">lon</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">161</span><span class="p">,</span><span class="mi">185</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
            <span class="n">lat</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">52</span><span class="p">,</span><span class="o">-</span><span class="mi">31</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">pres_vars</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;ss&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">),</span>
        <span class="n">time_resample</span><span class="o">=</span><span class="s1">&#39;1D&#39;</span><span class="p">,</span> <span class="n">time_lapse</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">region</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="n">default_region_reduced</span><span class="p">),</span> 
        <span class="n">pca_plot</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
        <span class="n">pca_ttls</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SS in t&#39;</span><span class="p">,</span> <span class="s1">&#39;SS in t-1&#39;</span><span class="p">]</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> loading the Moana v2 hindcast data (ss)... 


 lets calculate the PCs... 


 calculated PCs matrix with shape: 
 (8065, 4032) 


 plotting 3 components with 2 EOFs + PC... 


 being the EOFs the slp, the gradient, in steps t, t-1 
</pre></div>
</div>
<img alt="../_images/analysis_pca_15_1.png" src="../_images/analysis_pca_15_1.png" />
<img alt="../_images/analysis_pca_15_2.png" src="../_images/analysis_pca_15_2.png" />
<img alt="../_images/analysis_pca_15_3.png" src="../_images/analysis_pca_15_3.png" />
<img alt="../_images/analysis_pca_15_4.png" src="../_images/analysis_pca_15_4.png" />
<img alt="../_images/analysis_pca_15_5.png" src="../_images/analysis_pca_15_5.png" />
<img alt="../_images/analysis_pca_15_6.png" src="../_images/analysis_pca_15_6.png" />
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="data_visualization.html" title="previous page"><span class="section-number">1. </span>Data visualization and validation</a>
    <a class='right-next' id="next-link" href="analysis_kma.html" title="next page"><span class="section-number">3. </span>KM analysis</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Javier Tausía Hoyal<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>